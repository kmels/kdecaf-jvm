\documentclass[12pt,letterpaper]{article}
\usepackage{listings}
\usepackage[usenames,dvipsnames]{color}
\usepackage{ifpdf}

\author{Carlos L\'{o}pez}
\title{KDecaf}

% "define" KDecaf
\lstdefinelanguage{KDecaf}{
  morekeywords={class,struct,true,false,void,%
    if,else,while,return,int,char,boolean},
  otherkeywords={{,},;,+,-,/,*,<=,>,<,<=,>=,!=,==,\%,@},
  sensitive=true,
  morecomment=[l]{//},
  morecomment=[n]{/*}{*/},
  morestring=[b]",
  morestring=[b]',
  morestring=[b]"""
}

\usepackage{color}
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}
 
% Default settings for code listings
\lstset{frame=tb,
  language=KDecaf,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  frame=none,
  breaklines=true,
  breakatwhitespace=true
  tabsize=3
}


\begin{document}
\maketitle
\section*{Gram\'{a}tica}

\subsection*{Keywords}
\begin{lstlisting}
class	struct	true	false	void	if	else
while	return	int	char	boolean
\end{lstlisting}

\subsection*{Producciones}
\begin{lstlisting}
program             ::=  'class' 'Program' '{' {declaration} '}'
declaration         ::=  varDeclaration
                       | structDeclaration 
                       | methodDeclaration
varDeclaration      ::=  varType ident '[' numericLit ']' ';'
                       | varType ident ';'
                       | structVarDecl
                       | structDeclaration ident ';'
                       | structDeclaration ident '[' numericLit ']' ';'
structVarDecl       ::=  'struct' ident ident ';'
structDeclaration   ::=  'struct' ident {varDeclarations}
varType             ::=  primitiveType 
                       | 'void'
primitiveType       ::=  'int' 
                       | 'char'
                       | 'boolean'
methodDeclaration   ::=  varType ident parameterList block
parameterList       ::=  '(' parameter [ ',' parameter ] ')'
parameter           ::=  primitiveType ident
                       | primitiveType ident '[' ']'
block               ::=  '{' {varDeclaration} '}'
statement           ::=  ifStatement 
                       | whileStatement
                       | returnStatement
                       | methodCall ';'
                       | block
                       | assignment
                       | expression ';'
ifStatement         ::=  'if' '(' expression ')' block 'else' block
                       | 'if' '(' expression ')' block                       
whileStatement      ::=  'while' '(' expression ')' block
returnStatement     ::=  'return' [expression] ';'
methodCall          ::=  ident '(' arguments ')'
arguments           ::=  expression [ ',' expression ]
assignment          ::=  location '=' expression
expression          ::=  expressionOp ['&&' | '||' expression ]
expressionOp        ::=  expressionSum [valueComparators expressionSum]
valueComparators    ::=  '<='|'<'|'>'|'>='|'=='|'!='
expressionSum       ::=  expressionMult [ '+'|'-' expressionSum ]
expressionMult      ::=  unaryOpExpression ['/'|'*','%' expressionMult]
unaryOpExpression   ::=  '-' simpleExpression 
                       | '!' simpleExpression
                       | simpleExpression
simpleExpression    ::=  literal
                       | '(' expression ')'
                       | methodCall
                       | location
literal             ::=  numericLit 
                       | charLit 
                       | 'false' 
                       | 'true'
location            ::=  ident '[' expression ']' ['.' location]
                       | ident ['.' location] 
\end{lstlisting}

\section*{Sistema de tipos}
\subsection*{Axiomas}

\textbf{Cualquier literal es de tipo varType}
\begin{lstlisting}
literal -> numericLit
{ literal.type = int;
  literal.value = numericLit.lexema }
literal -> charLit
{ literal.type = char;
  literal.value = charLit.lexema.charAt(0) }
literal -> 'false' | 'true'
{ literal.type = boolean;
  literal.value = lexema.toBoolean }
\end{lstlisting}

\subsection*{Reglas sem\'{a}nticas}
\textbf{Identificadores}
\begin{lstlisting}
{ assert(exists(ident));
  location = lookUp(ident); }  
\end{lstlisting}

\begin{lstlisting}
location -> ident '[' expression ']' 
{ assert(lookUp(ident).isInstanceOf[KArray]);
  assert(expression.isInstanceOf[int]);
  location = lookUp(ident).getUnderlyingType }
\end{lstlisting}

\begin{lstlisting}
location -> ident '[' expression ']' '.' location2
{ assert(lookUp(ident).isInstanceOf[KArray]);  
  assert(expression.isInstanceOf[int]);
  val s = lookup(ident).getUnderlyingType
  assert(s.isInstanceOf[Struct])
  val = varDeclarations = s.varDeclarations
  assert(varDeclarations.exists(_.id == location2.literal));
  location = T.find(_.id == location2).get }
\end{lstlisting}


\end{document}